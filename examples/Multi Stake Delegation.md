
# Cardano Example Dapp

## **Multi Stake Delegation**

Script that sets up a wallet workspace to generate 3 addresses, to later fund them and delegate their stake to different staking pools on a single transaction. The optional registration transaction is meant to fail when keys are already registered, don't panic, script is built to succeed anyways


## Try it online: 

-  Visit [HTML5 Dapp](https://gamechangerfinance.github.io/gamechanger.wallet/examples/Multi%20Stake%20Delegation.html)
-  Run [Standalone URL dapp connection](https://beta-wallet.gamechanger.finance/api/2/run/1-H4sIAAAAAAAAA8VY33PaOBD-VzS85G6GEoPNr7wBuV4z7V0zTW56M508LNIaNDW2a8kXmAz_-61kjG1wgZB0wkuilfbTp93Pu7KfGnoVY-OqoXgiY91oNrTUgTH8lQZasjsN35FdY4Az0DIKaYHAbK0ZXTXu7P9Mz0EzhVqxNGbAHiEIULPHKPmuYuDIdMRmGGICGpnLQIgElULVNBMBGRPmp6EgGFwwoH9EtiMai0yYsjRorZC-jwmG2ppkOGNxFAWKRSHtqmgc0LIEQgXcEGyx-zmyyJKFgCU4k4qmzbC8jEnFFgiESlv4IAP2OMeQfceVYpAggyBBEKuNP-0vmkxE4YVmMYSSN1kWEQMzTWVgYVTKOaKg06weYaUocAn-SGVCsX1qhJE2f7Iw3VMGbiiW3xq41BgqE9iH9bpJwzhK9Ejl2SjScI2LyCLqNAn_-fLpFjTRMvmYax1fXV4GEYdgHil95TqOcylo_SXE8lJAHBvHNCz2vyOU2Aw3UggiEJMo9OWMVqaxoDTciJyDFcQekQBWmBDPb1uQr3nqaVZqXGSTISyw4GpYqVxyhfl6Yy4JrZj8mimLpKYp24pxyoymME9XzMBtMqEa64d1c0vmI64Ib6vGG2HYbLZ_-Dm_uxhDQb7vFiCN8klvJg7KmGkInEdpqG9CgcvGlUOGTNa5wRDYATTBqwE05vMAc4bOMXrdXbRh5wC_0TFyrreL53XcA4DjY4A9t7OL2Pdc7wDk5Bhkp7eH2PUquhhls-doY-OaZ9IG_TadErG_aV2NeCzH6oqKGvZPmm_hjA5v4BxGHx2CHr8IenwIevIi6EkN9Bd8hETkG4yef-wqwPj5h6sCTI4e4cHIrUHFqiiHRZ0l8yRNTDMrF8uSErclcm2KoQkchlyiKmPkbXtT0U3LKk3PUBO3QPKPaFsQTReHeYJES586oCG-Npts-3IVYrQ1H0Ww3bjkTc0DyOs_CFJ79NHtH_-SuU9OIHq9DrYHDkevi13edbxht89F2_XaQ8_h_Q70nUG_M_D7yH3eQ9cbEtTo0_sRIQx8f-rxAfa8AXcIyO_AsN0m_2HHR4Bh12-DKzrkjoAw6HT7U1cMhEH4fP-nYTZtO-1Bv-v2ukNw-i73XBD9Lm_7Hc_1h31wB8MeeN3poA29NnVRBBoP_YbpzOWLxAQTXZuSUvv-srd-m7FRyZWjiafk1NFogRnZnGZFzuqqDERLYiu8D6DmH0x9azxRtn674MDn2CorpmV00SqejVbF8eL3tT3V-A2ojOupTN6AyqSOyto-e8_N93WNx5kZr0K9cc5fi8yrZP21yBzIe37NPS3n1dVn57v0rvV6uc5K82lgtoi3TKk-VyUvP0KNQs44AvWKc7X18iPU6Or5R6BmlQvSnEIvD3V_8_IpKsWwWGvn7pe0OMzuKfZN9d3OI6SXxqUUH7vdNWGO8okjtPcKXytLQdOijM9GGZdQJmejTIqn2waklOejoRJlTWSBilIdp1llsPHZXKAOcdresVrF_T43ZhIBZT6k2HeOOKK728reBEFAPre5aGaWHymE9AK9IkPbyX725Td7Zs8jNP4lhCbnE5r8AkLr5r7OMThV5ju9oRA5BqdqfBdiXECcKvBdiJK8lZyVNW2G90u10XRxhTd2FO-eqHSt7TcXDTJAcYvJQirzKYoC40OgcFt7KhWjyo1WtPZqEFm31a_0CP3Es3ggCz97nHS6kLqM-zl5T1TLR7RLag9pZzSdc6fcLSJhPMPoK0j78XNp3_53mZkgVYqJYfWwZVVbRE5hU6koGy4xJOYTV3CETeGacTEx8mVIrqsj95SdT4n3xWfQ0p0lqW8iC-BJlK86LfXU6Da6FnVhOgGxKokcz_z-B05qDNy-FgAA)

## Source code:

- dapp connection code: [GCScript DSL](Multi%20Stake%20Delegation.gcscript)
- frontend (using @gamechanger-finance/gc): [HTML5 dapp](Multi%20Stake%20Delegation.html)
- frontend (without official library): [Native HTML5 dapp](Multi%20Stake%20Delegation_nolib.html)

Dapp code was autogenerated by [Playground IDE in GameChanger Wallet ](https://beta-wallet.gamechanger.finance/playground)

## GCScript code (dapp connection):
```json
{
  "type": "script",
  "title": "Multi Stake Delegation",
  "description": "Script that sets up a wallet workspace to generate 3 addresses, to later fund them and delegate their stake to different staking pools on a single transaction. The optional registration transaction is meant to fail when keys are already registered, don't panic, script is built to succeed anyways",
  "require": {
    "not": {
      "walletTypeIn": [
        "extension"
      ]
    }
  },
  "exportAs": "MultiDelegationDemo",
  "returnURLPattern": "http://localhost:3000/demo/api/dapp",
  "run": {
    "walletSetup": {
      "type": "loadConfig",
      "updateId": "MultiStakeDelegationDemo",
      "layers": [
        {
          "type": "Workspace",
          "items": [
            {
              "namePattern": "demos",
              "titlePattern": "Demos",
              "descriptionPattern": "Wallet settings created by demo scripts"
            }
          ]
        },
        {
          "type": "Key",
          "workspaceIds": [
            "demos"
          ],
          "items": [
            {
              "namePattern": "SpendKey-main",
              "kind": "spend",
              "accountIndex": 0,
              "addressIndex": 0
            },
            {
              "namePattern": "StakeKey-main",
              "kind": "stake",
              "accountIndex": 0,
              "addressIndex": 0
            },
            {
              "namePattern": "SpendKey-0",
              "kind": "spend",
              "accountIndex": 5,
              "addressIndex": 92
            },
            {
              "namePattern": "StakeKey-A",
              "kind": "stake",
              "accountIndex": 34,
              "addressIndex": 423
            },
            {
              "namePattern": "StakeKey-B",
              "kind": "stake",
              "accountIndex": 632,
              "addressIndex": 7434
            },
            {
              "namePattern": "StakeKey-C",
              "kind": "stake",
              "accountIndex": 26,
              "addressIndex": 754
            }
          ]
        },
        {
          "type": "Address",
          "workspaceIds": [
            "demos"
          ],
          "items": [
            {
              "namePattern": "Address-main",
              "spendPubKeyName": "SpendKey-main",
              "stakePubKeyName": "StakeKey-main"
            },
            {
              "namePattern": "Address-0A",
              "spendPubKeyName": "SpendKey-0",
              "stakePubKeyName": "StakeKey-A"
            },
            {
              "namePattern": "Address-0B",
              "spendPubKeyName": "SpendKey-0",
              "stakePubKeyName": "StakeKey-B"
            },
            {
              "namePattern": "Address-0C",
              "spendPubKeyName": "SpendKey-0",
              "stakePubKeyName": "StakeKey-C"
            },
            {
              "namePattern": "RewardAddress-A",
              "stakePubKeyName": "StakeKey-A"
            },
            {
              "namePattern": "RewardAddress-B",
              "stakePubKeyName": "StakeKey-B"
            },
            {
              "namePattern": "RewardAddress-C",
              "stakePubKeyName": "StakeKey-C"
            }
          ]
        }
      ]
    },
    "setWorkspace": {
      "type": "setCurrentWorkspace",
      "workspaceId": "demos"
    },
    "dependencies": {
      "type": "script",
      "run": {
        "keys": {
          "type": "getPublicKeys",
          "keyPattern": "{artifactName}"
        },
        "addresses": {
          "type": "getAddresses",
          "keyPattern": "{artifactName}"
        },
        "pools": {
          "type": "data",
          "value": {
            "APEX": "7facad662e180ce45e5c504957cd1341940c72a708728f7ecfc6e349",
            "ALFA": "8ffb4c8e648c0662f2a91157c92feaa95f1a3d2728eaea8257b3d8d9",
            "OTG": "db1018753659a073c43ad75c1f243f97a3896a45b81a61300ea96a9f"
          }
        },
        "registrationCerts": {
          "type": "script",
          "exportAs": "RegistrationCerts",
          "run": {
            "A": {
              "type": "certificate",
              "cert": {
                "kind": "StakeRegistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-A.pubKeyHashHex')}"
              }
            },
            "B": {
              "type": "certificate",
              "cert": {
                "kind": "StakeRegistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-B.pubKeyHashHex')}"
              }
            },
            "C": {
              "type": "certificate",
              "cert": {
                "kind": "StakeRegistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-C.pubKeyHashHex')}"
              }
            }
          }
        },
        "deregistrationCerts": {
          "type": "script",
          "exportAs": "DeregistrationCerts",
          "run": {
            "A": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDeregistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-A.pubKeyHashHex')}"
              }
            },
            "B": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDeregistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-B.pubKeyHashHex')}"
              }
            },
            "C": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDeregistration",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-C.pubKeyHashHex')}"
              }
            }
          }
        },
        "delegationCerts": {
          "type": "script",
          "exportAs": "DelegationCerts",
          "run": {
            "A": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDelegation",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-A.pubKeyHashHex')}",
                "poolKeyHashHex": "{get('cache.dependencies.pools.APEX')}"
              }
            },
            "B": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDelegation",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-B.pubKeyHashHex')}",
                "poolKeyHashHex": "{get('cache.dependencies.pools.ALFA')}"
              }
            },
            "C": {
              "type": "certificate",
              "cert": {
                "kind": "StakeDelegation",
                "pubKeyHashHex": "{get('cache.dependencies.keys.StakeKey-C.pubKeyHashHex')}",
                "poolKeyHashHex": "{get('cache.dependencies.pools.OTG')}"
              }
            }
          }
        }
      }
    },
    "txs": {
      "type": "script",
      "run": {
        "buildRegistration": {
          "type": "buildTx",
          "name": "built-registration",
          "tx": {
            "certificates": {
              "DRegA": {
                "certHex": "{get('cache.dependencies.registrationCerts.A')}"
              },
              "DRegB": {
                "certHex": "{get('cache.dependencies.registrationCerts.B')}"
              },
              "DRegC": {
                "certHex": "{get('cache.dependencies.registrationCerts.C')}"
              }
            }
          }
        },
        "buildDelegation": {
          "type": "buildTx",
          "name": "built-delegation",
          "tx": {
            "outputs": {
              "A": {
                "address": "{get('cache.dependencies.addresses.Address-0A.address')}",
                "assets": [
                  {
                    "policyId": "ada",
                    "assetName": "ada",
                    "quantity": "10000000"
                  }
                ]
              },
              "B": {
                "address": "{get('cache.dependencies.addresses.Address-0B.address')}",
                "assets": [
                  {
                    "policyId": "ada",
                    "assetName": "ada",
                    "quantity": "10000000"
                  }
                ]
              },
              "C": {
                "address": "{get('cache.dependencies.addresses.Address-0C.address')}",
                "assets": [
                  {
                    "policyId": "ada",
                    "assetName": "ada",
                    "quantity": "10000000"
                  }
                ]
              }
            },
            "certificates": {
              "DelA": {
                "certHex": "{get('cache.dependencies.delegationCerts.A')}"
              },
              "DelB": {
                "certHex": "{get('cache.dependencies.delegationCerts.B')}"
              },
              "DelC": {
                "certHex": "{get('cache.dependencies.delegationCerts.C')}"
              }
            }
          }
        },
        "sign": {
          "type": "signTxs",
          "namePattern": "signed-{key}",
          "detailedPermissions": false,
          "txs": {
            "registration": "{get('cache.txs.buildRegistration.txHex')}",
            "delegation": "{get('cache.txs.buildDelegation.txHex')}"
          }
        },
        "submitRegistrationOrFail": {
          "type": "submitTxs",
          "namePattern": "submitted-registration",
          "mode": "noWait",
          "txs": [
            "{get('cache.txs.sign.registration')}"
          ]
        },
        "submitDelegation": {
          "type": "submitTxs",
          "namePattern": "submitted-delegation",
          "mode": "parallel",
          "txs": [
            "{get('cache.txs.sign.delegation')}"
          ]
        }
      }
    },
    "finally": {
      "type": "script",
      "exportAs": "MultiDelegationTransactions",
      "run": {
        "registration": {
          "type": "macro",
          "run": "{get('cache.txs.buildRegistration.txHash')}"
        },
        "delegation": {
          "type": "macro",
          "run": "{get('cache.txs.buildDelegation.txHash')}"
        }
      }
    }
  }
}
```

## Run standalone QR dapp connection: 

You can use [Playground IDE in GameChanger Wallet ](https://beta-wallet.gamechanger.finance/playground) in `QR URL Transport` mode to capture results

[![This GCScript/URL is too large! make it shorter uploading parts to GCFS. Unable to generate QR code](Multi%20Stake%20Delegation.png)](https://gamechangerfinance.github.io/gamechanger.wallet/examples/Multi%20Stake%20Delegation.png)

## Resources
- [How to connect?](https://www.npmjs.com/package/@gamechanger-finance/gc)
- [Docs and examples on Github](https://github.com/GameChangerFinance/gamechanger.wallet/)
- [GCScript documentation](https://beta-wallet.gamechanger.finance/doc/api/v2)
- [Playground IDE in GameChanger Wallet ](https://beta-wallet.gamechanger.finance/playground)
- [Tutorials on Youtube](https://www.youtube.com/@gamechanger.finance)
- [Support on Discord](https://discord.gg/vpbfyRaDKG)
- [News on Twitter](https://twitter.com/GameChangerOk)
- [Website](https://gamechanger.finance)

## License
MIT 
    
